# Gemini Chat — 发布记录

## v1.8.1 — 2026-02-26
- **修复与优化：图片生成与连续编辑能力**
  - **意图穿透 (Bypass Refusal)**：在系统级 Prompt 中实施了强制指令，成功绕过大模型对“修改真实照片”时的过度安全拒绝（Pixel-level edit refusal），强制唤起绘图工具进行二次艺术创作。
  - **Tool Call 鲁棒性升级**：针对部分模型（如 gemini-3-flash-preview）无法标准调用工具而选择输出拟态 JSON（例如 `[generate_image: {...}]`）的行为，重写了前端拦截器的正则提取逻辑，确保任意带壳的伪调用均能被正确截获并执行。
  - **编辑基准图逻辑修复**：修复了“用户主动上传实拍图片并要求修改”时，因历史记录仅回溯 assistant 角色而导致找不到底图的 Bug，现已支持全历史记录追溯。

## v1.8.0 — 2026-02-25
- **新增：专属记忆数据管理与更新 UI**
  - **用户端**：主界面新增侧栏记忆管理抽屉，以弹窗形式列出所有检索记忆，支持预览、重写编辑（将自动唤起向量重新演算）以及单条删除、全部清空。
  - **管理端**：全新加入后台 `记忆池管理` Tab。后台采用按用户群组自动折叠卡片的方式呈现全局记忆网络视图。支持对特定用户的彻底清空与任意单条删除。
  - **接口强化**：扩充并补全与 Supabase pgvector 相关的向量覆写与 CRUD 端点，增设 Admin 严苛校验令牌的授权访问。


## v1.7.1 — 2026-02-25
- **优化：记忆抽取 (RAG) 交互体验**
  - 使用更优雅的浮动 Toast 提示替换原先会阻塞界面的 `alert()`
  - 抽取长效记忆时，侧边栏按钮转换为禁用并在原位置展示加载动画
  - 支持记录独立会话的状态，多会话状态不互串

## v1.7.0 — 2026-02-25
- **新增：AI 驱动的图片生成意图检测（Function Calling）**
  - 聊天模型通过 `generate_image` 工具自主判断用户是否需要生成/编辑图片
  - 替代旧的关键词匹配方案，准确度大幅提升
  - 支持文本 fallback 检测（兼容模型以 JSON 文本输出工具调用的情况）
- **新增：图片点击放大 & 下载**
  - 聊天中的图片支持点击全屏 Lightbox 预览
  - Lightbox 内提供下载按钮，支持 ESC / 点击背景关闭
- **优化：图片编辑流程**
  - 支持用户上传图片后发送编辑指令（如「把地面修改一下」）
  - 连续编辑时自动携带上次生成的图片作为编辑基准
  - 图片编辑 prompt 自动添加「基于原图修改」指令，避免重新生成
  - 修复 `thought_signature` 错误：历史图片不再以 model 角色发送
- **优化：Admin 后台**
  - 新增 Tab 导航（用户管理 / 模型管理）
  - 模型配置改用下拉选择器替代文本输入
- **优化：性能**
  - assistant 消息中的大体积 base64 图片不再发送给 chat API，用文字占位替代

## v1.6.0 — 2026-02-25
- **新增：模型与配置管理**
  - Admin 后台新增 Model Configuration 面板
  - 支持从 Gemini API 一键获取所有可用模型列表
  - 可管理聊天可用模型、默认模型、记忆摘要模型、向量嵌入模型、图片生成模型
  - 配置集中存储在 Supabase `app_config` 表，支持自动初始化
  - 前端聊天模型列表和默认模型从配置动态加载
  - 后端 API（chat、vectorize、generate-image）从配置读取模型名称
  - 提供 `supabase/init_app_config.sql` 初始化脚本

## v1.5.1 — 2026-02-25
- **新增：长效记忆 (RAG) 系统**
  - 集成 Supabase + pgvector，支持对话历史向量化存储与相似度检索
  - 自动提取对话摘要并建立记忆索引，提升 AI 长期上下文理解能力
- **新增：Supabase 后端集成**
  - 支持多设备访问授权、激活码校验
  - 云端同步系统指令（System Instructions）
- **新增：管理后台 (/admin)**
  - 支持激活码生成、用户状态管理及设备权限控制
- **优化与修复**
  - 升级模型：采用 `gemini-3-flash-preview` 进行摘要提取，`gemini-embedding-001` 进行向量嵌入
  - 解决 pgvector 3072 维向量索引限制问题（采用精确搜索）
  - 修复 Vercel AI SDK 消息载荷解析异常导致的记忆提取失败
  - 完善 API 日志记录与调试机制


## v1.4.0 — 2026-02-24
- 重构：将 page.tsx（~990行）拆分为 5 个独立组件和 3 个自定义 Hooks
  - 组件：ActivationGate、ChatHeader、ConversationDrawer、MessageList、InputBar
  - Hooks：useAuth、useConversations、useChatStream
  - 主页面缩减至 ~100 行组合层
- 新增 `src/types/chat.ts` 共享类型定义
- 功能无变化，纯结构优化

## v1.3.3 — 2026-02-24
- 主题色跟随系统深色/浅色模式切换
- themeColor meta 标签适配双主题

## v1.3.2 — 2026-02-24
- 改进图片生成请求的关键词检测逻辑
- 支持更多中英文绘图关键词匹配

## v1.3.1 — 2026-02-24
- 图片生成功能优化

## v1.3.0 — 2026-02-23
- 新增 AI 图片生成功能（Gemini 2.5 Flash Image）
- 智能识别绘图意图，支持连续对话编辑图片
- 支持用户上传图片发送

## v1.2.1 — 2026-02-23
- PWA 安装优化

## v1.1.2 — 2026-02-22
- Bug 修复和稳定性改进

## v1.1.1 — 2026-02-22
- 性能优化

## v1.1.0 — 2026-02-22
- 新增 Google Search 工具（grounding 联网搜索）
- 系统指令自定义功能
- 会话管理侧栏抽屉
- Thinking 思考过程可视化

## v1.0.1 — 2026-02-21
- 初始版本修复

## v1.0.0 — 2026-02-21
- 首次发布
- 基于 Gemini 的流式聊天
- 激活码鉴权系统
- PWA 支持（可安装、离线缓存）
- 多会话管理（IndexedDB 存储）
- Markdown 渲染
- 响应式 UI，移动端优先设计
